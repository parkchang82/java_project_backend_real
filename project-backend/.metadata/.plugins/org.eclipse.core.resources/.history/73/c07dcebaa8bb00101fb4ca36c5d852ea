package com.example.demo;

import java.util.Map;

// ... (ë‹¤ë¥¸ import ìƒëµ)
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; // ì•”í˜¸í™”ë¥¼ ìœ„í•´ í•„ìš”
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;


@RestController
@RequestMapping("/api") // ëª¨ë“  APIëŠ” /apië¡œ ì‹œì‘
public class AuthController {
	
	@Autowired
	private UserRepository repo; // User ì—”í‹°í‹° ì €ì¥ì„ ìœ„í•´ í•„ìš”
	
	// (ë¡œê·¸ì¸ DTO ë° ë¡œì§ ìƒëµ...)
	// ... @PostMapping("/login") ë©”ì„œë“œ ...


    // ğŸš€ íšŒì›ê°€ì… REST API
	@PostMapping("/signup")
	public ResponseEntity<?> registerUser(@RequestBody User user) {
		
        // 1. ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”
		BCryptPasswordEncoder encoder = new BCryptPasswordEncoder();
		String encodedPassword = encoder.encode(user.getPassword());
		user.setPassword(encodedPassword);
		
		try {
            // 2. DB ì €ì¥ ë° ì‘ë‹µ
			repo.save(user);
			return ResponseEntity.status(HttpStatus.CREATED).body(Map.of("success", true, "message", "íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."));
		} catch (Exception e) {
            // 3. ì˜¤ë¥˜ ì²˜ë¦¬ (ì˜ˆ: ì´ë©”ì¼ ì¤‘ë³µ)
			return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(Map.of("success", false, "message", "ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì´ê±°ë‚˜ ì„œë²„ ì˜¤ë¥˜ì…ë‹ˆë‹¤."));
		}
	}
}